<!doctype html>
<html class="no-js" lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Alex Crawford</title>
		<link rel="stylesheet" href="/assets/css/app.css" />
		<link rel="stylesheet" href="/assets/css/vendor/prism.css" />
		<link rel="stylesheet" href="/assets/css/vendor/prism-okaidia.css" />
		<link rel="stylesheet" href="/assets/css/override.css" />
	    <script src="/assets/js/vendor/modernizr.js"></script>
	</head>
	<body>
		<nav id="topnav" class="top-bar" data-topbar role="navigation">
			<ul class="title-area">
				<li class="name">
					<h1><a href="/">Alex Crawford</a></h1>
				</li>
				<li class="toggle-topbar menu-icon">
					<a href="#"><span>Menu</span></a>
				</li>
			</ul>

			<section class="top-bar-section">

				<ul class="right contact_icons hide-for-small">
					<li>
						<a href="http://twitter.com/awc737" target="_blank">
							<i class="fa fa-twitter fa-2x"></i>
						</a>
					</li>
					<li>
						<a href="https://github.com/awc737" target="_blank">
							<i class="fa fa-github fa-2x"></i>
						</a>
					</li>
					<li>
						<a href="https://www.linkedin.com/in/awc737" target="_blank">
							<i class="fa fa-linkedin fa-2x"></i>
						</a>
					</li>
				</ul>

				<ul class="left">
					<li class="">
						<a href="/blog">Blog</a>
					</li>
					<li class="active">
						<a href="/projects">Projects</a>
					</li>
					<li class="">
						<a href="/code">Code</a>
					</li>
				</ul>

				<ul class="right mobile_contact_icons show-for-small">
					<div class="icon-bar five-up">
						<a href="http://twitter.com/awc737" class="item"><i class="fa fa-twitter fa-2x"></i></a>
						<a href="https://github.com/awc737" class="item"><i class="fa fa-github fa-2x"></i></a>
						<a href="https://www.linkedin.com/in/awc737" class="item"><i class="fa fa-linkedin fa-2x"></i></a>
					</div>
				</ul>

			</section>
		</nav>

		<div id="page">
			
			
				<!-- Nested layout -->

<div class="row">
	
	<div class="large-8 columns  large-pull-right">

		<ul class="breadcrumbs">
			<li><a href="/">Home</a></li>

			
				<li><a href="/projects">projects</a></li>
			

			
				<li class="current"><a href="#">JELD-WEN</a></li>
			
		</ul>

		
			<h3>JELD-WEN</h3>
			<hr>
		

		<p>Within two years, I became the largest contributor to JELD-WEN.com with 100,000 lines of code and 50,000 deletions. I developed and maintained numerous components integrating with internal web services, implemented security measures, and managed web development operations within the company.</p>
<ul>
<li><a href="http://www.jeld-wen.com/professional/tools-education/egress-openings-calculator">Egress Calculator</a></li>
<li><a href="http://www.jeld-wen.com/findastore">Find a Store</a></li>
<li><a href="http://homedepot.jeld-wen.com/more-info/order-status">Order Locator</a></li>
</ul>

	</div>

	<div class="large-4 columns">

		<!--
		
			<img src="/assets/img/projects/jeld-wen.png">
		
		-->
		
		
			<h3 class="header">Related Files</h3>
			<ul class="no-bullet">
				
					<li>
						<i class="fa fa-file-code-o"></i>
						<a href="#" data-reveal-id="modal-js_egresscalc">
							egresscalc.js
						</a>
					</li>

					<div id="modal-js_egresscalc" class="reveal-modal" data-reveal>
						<pre><code class="language-javascript">if ($(&#39;#com_jw_egresscalc&#39;).length &gt; 0 ) {
    var egresscalc = new Com_jw_egresscalc();
    egresscalc.init();
}

function Com_jw_egresscalc () {

    var self = this;
    self.allOptions;
    self.inputForm = $(&#39;#com_jw_egresscalc form&#39;);
    self.inputMaterial = $(&#39;#com_jw_egresscalc form select[name=&quot;material&quot;]&#39;);
    self.inputProduct = $(&#39;#com_jw_egresscalc form select[name=&quot;product&quot;]&#39;);
    self.inputStyle = $(&#39;#com_jw_egresscalc form select[name=&quot;style&quot;]&#39;);
    self.inputSizes = $(&#39;#com_jw_egresscalc form #egresscalc-size-input&#39;);
    self.inputSizesType = $(&#39;#com_jw_egresscalc form input[name=&quot;input-size-type&quot;]&#39;);
    self.inputFrameWidth = $(&#39;#com_jw_egresscalc form input[name=&quot;frameWidth&quot;]&#39;);
    self.inputFrameWidthFraction = $(&#39;#com_jw_egresscalc form select[name=&quot;frameWidth_fraction&quot;]&#39;);
    self.inputFrameHeight = $(&#39;#com_jw_egresscalc form input[name=&quot;frameHeight&quot;]&#39;);
    self.inputFrameHeightFraction = $(&#39;#com_jw_egresscalc form select[name=&quot;frameHeight_fraction&quot;]&#39;);
    self.inputLegHeight = $(&#39;#com_jw_egresscalc form input[name=&quot;legHeight&quot;]&#39;);
    self.inputLegHeightFraction = $(&#39;#com_jw_egresscalc form select[name=&quot;legHeight_fraction&quot;]&#39;);
    self.selectedInputSizesType = &#39;fraction&#39;;
    self.formulas = [];
    self.results = [];
    self.errors = {};
    self.egressChecks = {
        first: {
            cow: &#39;&gt;= 20&#39;,
            coh: &#39;&gt;= 24&#39;,
            cos: &#39;&gt;= 5.0&#39;,
            vas: &#39;&gt;= 0&#39;,
            dos: &#39;&gt;= 0&#39;
        },
        second: {
            cow: &#39;&gt;= 20&#39;,
            coh: &#39;&gt;= 24&#39;,
            cos: &#39;&gt;= 5.7&#39;,
            vas: &#39;&gt;= 0&#39;,
            dos: &#39;&gt;= 0&#39;
        }
    }
    /*
    self.egressChecks = {
        cow: &#39;&gt;= 20&#39;,
        coh: &#39;&gt;= 24&#39;,
        cos: {
            first: &#39;&gt;= 5.0&#39;,
            second: &#39;&gt;= 5.7&#39;
        }
        vas: &#39;&gt;= 0&#39;,
        dos: &#39;&gt;= 0&#39;
    }
    */

    self.init = function() {
        self.inputMaterial.attr(&quot;disabled&quot;, true);
        self.inputProduct.attr(&quot;disabled&quot;, true);
        self.inputStyle.attr(&quot;disabled&quot;, true);

        self.getOptions().done(function(data) {
            self.allOptions = JSON.parse(data);
            self.fillMaterials();
            self.inputMaterial.bind(&#39;change&#39;, self.fillProducts);
            self.inputProduct.bind(&#39;change&#39;, self.fillStyles);
            self.inputStyle.bind(&#39;change&#39;, self.showHideSizing);
            self.inputSizesType.bind(&#39;change&#39;, self.switchSizesType);
            self.inputForm.bind(&#39;submit&#39;, function(e){
                e.preventDefault();
                self.processForm();
            });
            self.inputSizes.find(&#39;input&#39;).bind(&#39;keyup&#39;, function(){
                $(&#39;#egresscalc-results&#39;).hide();
            });
            self.inputSizes.find(&#39;select&#39;).bind(&#39;change&#39;, function(){
                $(&#39;#egresscalc-results&#39;).hide();
            });
        });
    }

    self.serviceDown = function(error) {
        $(&#39;#egresscalc-service-down&#39;).show();
        if (typeof error != &#39;undefined&#39;) {
            console.log(error);
        }
    }

    self.getOptions = function() {
        return $.ajax({
            url: &#39;index.php/?option=com_jw_egresscalc&amp;task=egresscalc.getOptions&amp;format=raw&#39;,
            error: function(xhr, status, error){
                self.serviceDown(xhr.status + &quot;: &quot; + error);
            }
        });
    }

    self.fillMaterials = function() {
        $.each(self.allOptions, function(index, material) {
            self.inputMaterial.append($(&#39;&lt;option&gt;&#39;, {value: index}).text(material.title));
        });
        self.inputMaterial.attr(&quot;disabled&quot;, false);
        self.inputProduct.attr(&quot;disabled&quot;, false);
        self.inputStyle.attr(&quot;disabled&quot;, false);
    }

    self.fillProducts = function() {
        var materialId = self.inputMaterial.val();

        self.clearInput(&#39;product&#39;);
        self.clearInput(&#39;style&#39;);
        self.showHideSizing();

        if (!materialId) {
            return;
        }

        $.each(self.allOptions[materialId].products, function(index, product) {
            self.inputProduct.append($(&#39;&lt;option&gt;&#39;, {value: index}).text(product.title));
        });
    }

    self.fillStyles = function() {
        var materialId = self.inputMaterial.val();
        var productId = self.inputProduct.val();

        self.clearInput(&#39;style&#39;);
        self.showHideSizing();

        if (!productId) {
            return;
        }

        $.each(self.allOptions[materialId].products[productId].styles, function(index, style) {
            self.inputStyle.append($(&#39;&lt;option&gt;&#39;, {value: style.id}).text(style.title));
        });
    }

    self.clearInput = function(inputField) {
        inputField = inputField.charAt(0).toUpperCase() + inputField.slice(1);
        eval(&#39;self.input&#39; + inputField).find(&#39;option:not(.placeholder)&#39;).remove();
    }

    self.showHideSizing = function() {
        var styleId = self.inputStyle.val();
        var frameWidth = self.inputFrameWidth.val();
        var frameHeight = self.inputFrameHeight.val();

        if (!styleId) {
            self.inputSizes.find(&#39;input[type=&quot;text&quot;], select&#39;).val(&#39;&#39;);
            self.inputSizes.hide();  
            $(&#39;#egresscalc-results&#39;).hide();
        } else {
            self.getFormula(styleId, frameWidth, frameHeight).done(function(data) {
                self.formulas = JSON.parse(data);
                $(&#39;#egresscalc-size-input&gt;h3&#39;).html(self.inputStyle.find(&#39;option:selected&#39;).text());
                self.inputSizes.show();
                if(self.formulas.has_leg == 1) {
                    $(&#39;#egresscalc-input-legheight&#39;).show();
                } else {
                    $(&#39;#egresscalc-input-legheight&#39;).hide();
                }
                self.errors = {};
                self.inputForm.find(&#39;input.error&#39;).removeClass(&#39;error&#39;).prev(&#39;.error&#39;).text(&#39;&#39;);
            });        
        }
    }

    self.switchSizesType = function() {
        self.selectedInputSizesType = $(&#39;input[name=&quot;input-size-type&quot;]:checked&#39;).val();
        self.inputForm.find(&#39;input.error&#39;).removeClass(&#39;error&#39;).prev(&#39;.error&#39;).text(&#39;&#39;);
        $(&#39;#egresscalc-results&#39;).hide();
        if(self.selectedInputSizesType === &#39;decimal&#39;) {
            self.inputSizes.find(&#39;select.fraction-dropdown&#39;).hide();
            self.inputSizes.find(&#39;select.fraction-dropdown&#39;).val(&#39;&#39;);
        } else {
            self.inputSizes.find(&#39;select.fraction-dropdown&#39;).show();
        }
    }

    self.processForm = function() {
        var styleId = self.inputStyle.val();
        var frameWidth = self.inputFrameWidth.val();
        var frameWidthFraction = self.inputFrameWidthFraction.val();
        var frameHeight = self.inputFrameHeight.val();
        var frameHeightFraction = self.inputFrameHeightFraction.val();
        var legHeight = self.inputLegHeight.val();
        var legHeightFraction = self.inputLegHeightFraction.val();
        var formulas = self.formulas;

        self.errors = {};
        self.validateField(self.inputFrameWidth);
        self.validateField(self.inputFrameHeight);
        if(self.formulas.has_leg == true){
            self.validateField(self.inputLegHeight);
        }

        if($.isEmptyObject(self.errors)) {
            if(self.selectedInputSizesType === &#39;fraction&#39;) {
                if(frameWidthFraction != &#39;&#39;){
                    frameWidth = self.addFraction(frameWidth, frameWidthFraction);
                }
                if(frameHeightFraction != &#39;&#39;){
                    frameHeight = self.addFraction(frameHeight, frameHeightFraction);
                }
                if(legHeightFraction != &#39;&#39;){
                    legHeight = self.addFraction(legHeight, legHeightFraction);
                }
            }
            self.postForm(styleId, frameWidth, frameHeight, legHeight, formulas).done(function(data) {
                self.results = JSON.parse(data);
                self.fillResults();
                self.checkResults();
            });
        } else {
            $(&#39;#egresscalc-results&#39;).hide();
        }
    }

    self.validateField = function(field) {
        field.removeClass(&#39;error&#39;);
        field.prev(&#39;.error&#39;).text(&#39;&#39;);

        var messages = {
            blank: &#39;This field can not be left blank.&#39;,
            numeric: &#39;This field must be a numeric value.&#39;,
            decimal: &#39;Please switch input type to decimals.&#39;,
            comma: &#39;This field may not contain commas.&#39;,
            fraction: &#39;Please switch input type to fractions.&#39;
        }

        // Number
        if(isNaN(field.val())) {
            self.errors[field.attr(&#39;name&#39;)] = messages.numeric;
            field.prev(&#39;.error&#39;).text(messages.numeric);
            field.addClass(&#39;error&#39;);
        }

        // Fraction
        if(self.selectedInputSizesType === &#39;decimal&#39;) {
            if(field.val().indexOf(&#39;/&#39;) != -1)
            {
                self.errors[field.attr(&#39;name&#39;)] = messages.fraction;
                field.prev(&#39;.error&#39;).text(messages.fraction);
                field.addClass(&#39;error&#39;);
            }
        }

        // Decimal
        if(self.selectedInputSizesType === &#39;fraction&#39;) {
            if(field.val().indexOf(&#39;.&#39;) != -1)
            {
                self.errors[field.attr(&#39;name&#39;)] = messages.decimal;
                field.prev(&#39;.error&#39;).text(messages.decimal);
                field.addClass(&#39;error&#39;);
            }
        }

        // Comma
        if(self.selectedInputSizesType === &#39;fraction&#39;) {
            if(field.val().indexOf(&#39;,&#39;) != -1)
            {
                self.errors[field.attr(&#39;name&#39;)] = messages.comma;
                field.prev(&#39;.error&#39;).text(messages.comma);
                field.addClass(&#39;error&#39;);
            }
        }

        // Blank
        if(field.val() === &#39;&#39;) {
            self.errors[field.attr(&#39;name&#39;)] = messages.blank;
            field.prev(&#39;.error&#39;).text(messages.blank);
            field.addClass(&#39;error&#39;);
        }
    }

    self.postForm = function(styleId, frameWidth, frameHeight, legHeight, formulas) {
        return $.ajax({
            url: &#39;index.php/?option=com_jw_egresscalc&amp;task=egresscalc.postForm&amp;format=raw&#39;,
            data: { styleId: styleId, frameWidth: frameWidth, frameHeight: frameHeight, legHeight: legHeight, formulas: formulas },
            error: function(xhr, status, error){
                self.serviceDown(xhr.status + &quot;: &quot; + error);
            }
        });
    }

    self.getFormula = function(styleId, framewidth, frameheight) {
        return $.ajax({
            url: &#39;index.php/?option=com_jw_egresscalc&amp;task=egresscalc.getFormula&amp;format=raw&#39;,
            data: { styleId: styleId },
            error: function(xhr, status, error){
                self.serviceDown(xhr.status + &quot;: &quot; + error);
            }
        });
    }

    self.fillResults = function() {
        $(&#39;#egresscalc-results&#39;).show();
        $(&#39;#egresscalc-results tbody tr&#39;).hide();
        $.each(self.results, function(index, value) {
            $(&#39;#com_jw_egresscalc #egresscalc-results tr[data-result=&quot;&#39; + index + &#39;&quot;]&#39;).show();
            $(&#39;#com_jw_egresscalc #egresscalc-results tr[data-result=&quot;&#39; + index + &#39;&quot;] td.result&#39;).html(value);
        });
    }

    self.checkResults = function() {
        var hasError = false;
        var errors = {
            second: {},
            first: {}
        };
        var errorMessages = {
            second: &quot;Meets IRC egress requirements for 1st floor only.&quot;,
            first: &quot;Does NOT meet IRC Egress Requirements.&quot;
        };
        $(&#39;#egresscalc-results td&#39;).removeClass(&#39;error&#39;);
        $.each(self.results, function(key) {
            $.each(self.egressChecks, function(floor) {
                if(!self.resultPasses(key, floor)) {
                    hasError = true;
                    errors[floor][key] = true;
                    $(&#39;#com_jw_egresscalc #egresscalc-results tr[data-result=&quot;&#39; + key + &#39;&quot;] td.&#39; + floor).addClass(&#39;error&#39;);
                }
            });
        });
        if(hasError === true) {
            $.each(errors, function(floor, value) {
                if(!$.isEmptyObject(value)){
                    $(&#39;#com_jw_egresscalc .result-message&#39;).html(&#39;&lt;span class=&quot;warning&quot;&gt;&#39; + errorMessages[floor] + &#39;&lt;/span&gt;&#39;);
                }
            });
        } else {
            $(&#39;#com_jw_egresscalc .result-message&#39;).html(&#39;&lt;span class=&quot;success&quot;&gt;Meets IRC Egress Requirements.&lt;/span&gt;&#39;);
        }
    }

    self.resultPasses = function(key, floor) {
        return eval(self.results[key] + self.egressChecks[floor][key]);
    }

    self.addFraction = function(number, fraction) {
        var splitFraction = fraction.split(&#39;/&#39;);
        fraction = splitFraction[0] / splitFraction[1];
        return parseFloat(number) + fraction;
    }

}
</code></pre>

					</div>
				
					<li>
						<i class="fa fa-file-code-o"></i>
						<a href="#" data-reveal-id="modal-php_egresscalc">
							egresscalc.php
						</a>
					</li>

					<div id="modal-php_egresscalc" class="reveal-modal" data-reveal>
						<pre><code class="language-php">&lt;?php

/**
 * @version     1.0.0
 * @package     com_jw_egresscalc
 * @copyright   JELD-WEN © Copyright 2012. All Rights Reserved.
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 * @author      Alex Crawford &lt;alexc@jeld-wen.com&gt; - JELD-WEN http://jeld-wen.com
 */

header(&#39;Content-Type: application/json&#39;);
defined(&#39;_JEXEC&#39;) or die;
require_once JPATH_COMPONENT.&#39;/controller.php&#39;;

class Jw_egresscalcControllerEgresscalc extends Jw_egresscalcController
{
    public function getOptions(){

        $allOptions = array();
        $materialModel = $this-&gt;getModel(&#39;material&#39;);
        $productModel = $this-&gt;getModel(&#39;product&#39;);
        $styleModel = $this-&gt;getModel(&#39;style&#39;);

        $materials = $materialModel-&gt;getMaterials();

        foreach($materials as $material) {
            $materialProducts = array();
            $products = $productModel-&gt;getProductsByMaterialId($material-&gt;id);
            foreach($products as $product) {
                $styles = $styleModel-&gt;getStylesByProductId($product-&gt;id);
                $productStyles = array();
                foreach($styles as $style) {
                    $productStyles[] = array(
                        &#39;id&#39; =&gt; $style-&gt;id,
                        &#39;title&#39; =&gt; $style-&gt;title
                    );
                }
                $materialProducts[] = array(
                    &#39;id&#39; =&gt; $product-&gt;id,
                    &#39;title&#39; =&gt; $product-&gt;title,
                    &#39;styles&#39; =&gt; $productStyles
                );
            }
            $allOptions[] = array(
                &#39;id&#39; =&gt; $material-&gt;id,
                &#39;title&#39; =&gt; $material-&gt;title,
                &#39;products&#39; =&gt; $materialProducts
            );
        }

        echo json_encode($allOptions);

    }

    public function postForm(){

        $styleId = (empty($_GET[&#39;styleId&#39;]) ? null : $_GET[&#39;styleId&#39;]);
        $formulas = (empty($_GET[&#39;formulas&#39;]) ? null : $_GET[&#39;formulas&#39;]);
        $frameWidth = (empty($_GET[&#39;frameWidth&#39;]) ? null : $_GET[&#39;frameWidth&#39;]);
        $frameHeight = (empty($_GET[&#39;frameHeight&#39;]) ? null : $_GET[&#39;frameHeight&#39;]);
        $legHeight = (empty($_GET[&#39;legHeight&#39;]) ? null : $_GET[&#39;legHeight&#39;]);

        $calcFormulas = array();
        $formulaAbbreviations = array(&#39;cow&#39;, &#39;coh&#39;, &#39;cos&#39;, &#39;vas&#39;, &#39;dos&#39;);
        foreach($formulaAbbreviations as $abbrv) {
            $jsonFormulas = json_decode($formulas[$abbrv]);
            if (!empty($jsonFormulas)) {
                $calcFormulas[$abbrv] = $jsonFormulas;
            }
        }

        $results = array();
        $variables = array(&#39;FrameWidth&#39;, &#39;FrameHeight&#39;);
        $values = array($frameWidth, $frameHeight);

        if($legHeight != null){
            array_push($variables, &#39;LegHeight&#39;);
            array_push($values, $legHeight);
        }

        foreach($calcFormulas as $abbrv =&gt; $formulaConditions){
            foreach($formulaConditions as $formulaCondition){
                $condition = str_replace($variables, $values, $formulaCondition-&gt;condition);
                $condition = (empty($condition) ? true : $condition);
                if($this-&gt;calc_string($condition)) {
                    $formula = str_replace($variables, $values, $formulaCondition-&gt;formula);
                    $result = $this-&gt;calc_string($formula);
                    $results[$abbrv] = $result;
                    array_push($variables, strtoupper($abbrv));
                    array_push($values, $result);
                    break;
                }

            }            
        }

        echo json_encode($results);

    }

    public function getFormula(){

        $styleId = (empty($_GET[&#39;styleId&#39;]) ? null : $_GET[&#39;styleId&#39;]);

        $formulaModel = $this-&gt;getModel(&#39;formula&#39;);
        $formulas = $formulaModel-&gt;getFormulaByStyleId($styleId);

        echo json_encode($formulas);

    }

    function calc_string($mathString)
    {
        $cf_DoCalc = create_function(&quot;&quot;, &quot;return (&quot;.$mathString.&quot;);&quot;);
        $rounded = round($cf_DoCalc(), 3);
        return $rounded;
    }

}
</code></pre>

					</div>
				
					<li>
						<i class="fa fa-file-code-o"></i>
						<a href="#" data-reveal-id="modal-js_findstore">
							findstore.js
						</a>
					</li>

					<div id="modal-js_findstore" class="reveal-modal" data-reveal>
						<pre><code class="language-javascript">var findstore;
var findstore.results;
var findstore.map;
var findstore.bounds;
var findstore.infoWindow;
var findstore.markers = [];
var findstore.mappings = [];
var findstore.dirMap;
var findstore.dirBounds;
var findstore.dirDisplay;
var findstore.dirService;
var findstore.dirMarkers = [];
var findstore.uriVars = {};

$(document).ready(function() {
    // limit loading findstore map
    if ($(&#39;#findstore-map&#39;).length != 0) {
        findstore.bounds = new google.maps.LatLngBounds();
        findstore.infoWindow = new google.maps.InfoWindow();
        findstore.map = new google.maps.Map(document.getElementById(&quot;findstore-map&quot;), {
            center: new google.maps.LatLng(0, 0),
            zoom: 2,
            mapTypeId: &#39;roadmap&#39;,
            mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU}
        });
        // get URI parameters
        var uriSegments = window.location.href.replace(/[?&amp;]+([^=&amp;]+)=([^&amp;]*)/gi, function(m,key,value) {
            findstore.uriVars[key] = value;
        });
        if (typeof(findstore.uriVars[&quot;uri&quot;]) !== &#39;undefined&#39;){
            initCheckbox(findstore.uriVars[&quot;uri&quot;]);
        }
    }

    // limit loading directions map
    if ($(&#39;#directions-map&#39;).length != 0) {
        findstore.dirBounds = new google.maps.LatLngBounds();
        findstore.dirService = new google.maps.DirectionsService();
        findstore.dirDisplay = new google.maps.DirectionsRenderer();
        findstore.dirMap = new google.maps.Map(document.getElementById(&quot;directions-map&quot;), {
            center: new google.maps.LatLng(0, 0),
            zoom: 2,
            mapTypeId: &#39;roadmap&#39;,
            mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU}
        });
        findstore.dirDisplay.setMap(findstore.dirMap);
        initDirections(dirAddress, dirPosition);
    }

    // IE indexOf workaround
    // https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/indexOf
    if (!Array.prototype.indexOf) {
        Array.prototype.indexOf = function (searchElement /*, fromIndex */ ) {
            &quot;use strict&quot;;
            if (this == null) {
                throw new TypeError();
            }
            var t = Object(this);
            var len = t.length &gt;&gt;&gt; 0;
            if (len === 0) {
                return -1;
            }
            var n = 0;
            if (arguments.length &gt; 1) {
                n = Number(arguments[1]);
                if (n != n) { // shortcut for verifying if it&#39;s NaN
                    n = 0;
                } else if (n != 0 &amp;&amp; n != Infinity &amp;&amp; n != -Infinity) {
                    n = (n &gt; 0 || -1) * Math.floor(Math.abs(n));
                }
            }
            if (n &gt;= len) {
                return -1;
            }
            var k = n &gt;= 0 ? n : Math.max(len - Math.abs(n), 0);
            for (; k &lt; len; k++) {
                if (k in t &amp;&amp; t[k] === searchElement) {
                    return k;
                }
            }
            return -1;
        }
    }
});

/* Click Events */

// Submit form
$(&#39;#findstore-submit&#39;).click(function() {
    $(&#39;#findstore-search&#39;).submit();
});

$(&#39;#findstore-search&#39;).submit(function(e) {
    e.preventDefault();
    $(&#39;#findstore-right-middle .message&#39;).remove();
    var form = this;
    validate(form).done(function(data) {
        findstore.results = data;
        initMappings();
    }).fail(function() {
        clearMap();
        clearResults();
    });
});

// Loading icon for any AJAX
$(&quot;.findstore-loading&quot;).bind(&quot;ajaxStart&quot;, function(){
    $(this).show();
}).bind(&quot;ajaxComplete&quot;, function(){
    $(this).hide();
});

// Show more results click event
$(&#39;#findstore-results .more-results&#39;).live(&quot;click&quot;, function(e) {
    var order = $(this).closest(&#39;tr&#39;).attr(&#39;data-order&#39;);
    var group = $(this).closest(&#39;tr&#39;).attr(&#39;data-group&#39;);
    findstore.mappings[order].open = true;
    showMore(order, group);
});

// Hide more results click event
$(&#39;#findstore-results .hide-results&#39;).live(&quot;click&quot;, function(e) {
    var order = $(this).closest(&#39;tr&#39;).attr(&#39;data-order&#39;);
    var group = $(this).closest(&#39;tr&#39;).attr(&#39;data-group&#39;);
    findstore.mappings[order].open = false;
    hideMore($(this).closest(&#39;tr&#39;).attr(&#39;data-order&#39;), $(this).closest(&#39;tr&#39;).attr(&#39;data-group&#39;));
});

$(&#39;#findstore-type-filters :input&#39;).live(&quot;click&quot;, function(e) {
    initMappings();
});

$(&#39;form[name=&quot;getDirections&quot;] #btnGetDirections&#39;).live(&quot;click&quot;, function(e) {
    e.preventDefault();
    var start = $(&#39;form[name=&quot;getDirections&quot;] input[name=&quot;fromAddress&quot;]&#39;).val();
    var end = $(&#39;form[name=&quot;getDirections&quot;] input[name=&quot;toAddress&quot;]&#39;).val();
    calcRoute(start, end);
});

/* Functions */

// retreive the data
function validate(form){
    var valid = true;
    findstore.results = null;
    var response = $.Deferred();

    if (valid === true) {
        var selZip = $(&#39;#findstore-zip&#39;).val();
        var selRadius = $(&#39;#findstore-radius&#39;).val();
        var selFilters = new Array();
        $(&#39;input[name=findstore-filters]:checked&#39;).each(function(key,val){
            selFilters.push($(val).val());
        });
        var selModel = findstore.uriVars[&#39;model&#39;];

        $.ajax({
            url: &#39;findastore?task=findstore.search&amp;format=raw&#39;,
            data: { selZip: selZip, selFilters: selFilters, selRadius: selRadius, selModel: selModel }
        }).done(function(data) {
            if ( data.length &gt; 0 ) {
                response.resolve(data);
            } else {
                response.reject();
            }
        }).fail(function() {
            response.reject();
        });
    } else {
        response.reject();
    }

    return response.promise();
}

// preselect checkboxes
function initCheckbox(uri) {
    var segments = uri.split(&quot;/&quot;);
    $.each(window.filters, function(f, filter){
        $.each(filter.mappings, function(m, mapping){
            if ($.isEmptyObject(mapping.uris)) {
                var matchAll = false;
            } else {
                var matchAll = true;
                var uris = $.parseJSON(mapping.uris);
                $.each(uris, function(u, uriString){
                    var uriArray = uriString.split(&#39;,&#39;);
                    $.each(uriArray, function(u, uri){
                        uriTrimmed = uri.replace(/\s/g, &#39;&#39;);
                        if (segments.indexOf(uriTrimmed) != -1) {
                        } else {
                            matchAll = false;
                        }
                    });
                });
            }
            if(matchAll){
                $(&#39;#findstore-filter-&#39; + mapping.id).attr(&#39;checked&#39;, &#39;checked&#39;);
            }
        });
    });
}

// prepare the directions iframe view
function initDirections(address, position){
    $(&#39;#findstore-direction-steps&#39;).empty();
    $(&#39;form[name=&quot;getDirections&quot;] input[name=&quot;toAddress&quot;]&#39;).val(address);

    for (i = 0; i &lt; findstore.dirMarkers.length; i++) {
        findstore.dirMarkers[i].setMap(null);
    }
    findstore.dirMarkers.length = 0;
    findstore.dirDisplay.setMap(null);

    findstore.dirBounds = new google.maps.LatLngBounds();

    position = position.replace(/[()]/g,&#39;&#39;);
    position = position.split(&#39;,&#39;);

    var marker = new google.maps.Marker({
        position: new google.maps.LatLng(position[0], position[1]),
        map: findstore.dirMap,
        icon: &#39;http://maps.google.com/mapfiles/ms/micons/green-dot.png&#39;
    });

    findstore.dirMarkers.push(marker);
    findstore.dirBounds.extend(marker.position);
    findstore.dirMap.fitBounds(findstore.dirBounds);
    findstore.dirMap.setZoom(14);
}

function calcRoute(start, end) {
    var request = {
        origin:start,
        destination:end,
        travelMode: google.maps.TravelMode.DRIVING
    };
    findstore.dirService.route(request, function(response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
            findstore.dirDisplay.setDirections(response);
            findstore.dirDisplay.setMap(findstore.dirMap);
            showSteps(response);
        }    
    });
}

function showSteps(directionResult) {
    $(&#39;#findstore-direction-steps&#39;).empty();

    for (i = 0; i &lt; findstore.dirMarkers.length; i++) {
        findstore.dirMarkers[i].setMap(null);
    }
    findstore.dirMarkers.length = 0;

    var route = directionResult.routes[0].legs[0];

    $(&#39;#findstore-direction-steps&#39;).append(
        &#39;&lt;h5&gt;&#39; + route.start_address + &#39;&lt;/h5&gt;&#39;    
    );

    for (var i = 0; i &lt; route.steps.length; i++) {
        $(&#39;#findstore-direction-steps&#39;).append(
            &#39;&lt;li class=&quot;step&quot;&gt;&lt;span&gt;&#39; + (i + 1) + &#39;.&lt;/span&gt;&lt;div class=&quot;detail&quot;&gt;&#39; + route.steps[i].instructions + &#39;&lt;/div&gt;&lt;/li&gt;&#39;
        );
    }

    $(&#39;#findstore-direction-steps&#39;).append(
        &#39;&lt;h5&gt;&#39; + route.end_address + &#39;&lt;/h5&gt;&#39;    
    );
}

function initMappings(){
    findstore.mappings.length = 0;
    $.each(findstore.results, function(i, result) {
        var latlng = new google.maps.LatLng(
            result[0].lat,
            result[0].lon
        );
        var marker = new google.maps.Marker({
            position: latlng
        })
        var mapping = {
            details: result[0],
            marker: marker,
            group: i,
            open: false
        }
        if($(result).length &gt; 1) {
            mapping.children = true;
        }
        findstore.mappings.push(mapping);
    });
    filterTypes();
    updateResults();
}

function showMore(order, group){
    $.each(findstore.results[group], function(s, store) {
        if (s &gt; 0) {
            var latlng = new google.maps.LatLng(
                store.lat,
                store.lon
            );    
            var marker = new google.maps.Marker({
                position: latlng
            });
            var mapping = {
                details: store,
                marker: marker,
                group: group,
                child: true
            }        
            findstore.mappings.splice(Number(order) + Number(s), 0, mapping);
        }
    });
    updateResults();
    var storeCount = findstore.results[group].length - 1;
    $(&#39;#findstore-results-body tr[data-order=&quot;&#39; + order + &#39;&quot;] .more-results&#39;).replaceWith(
        &#39;&lt;div class=&quot;hide-results&quot;&gt;- Hide more stores (&#39; + storeCount + &#39;)&lt;/div&gt;&#39;
    );
}

function hideMore(order, group){
    index = (Number(order) + 1);
    amount = $(&#39;#findstore-results-body tr[data-group=&quot;&#39; + group + &#39;&quot;]&#39;).length - 1;
    findstore.mappings.splice(index, amount);
    updateResults();
    var storeCount = findstore.results[group].length - 1;
    $(&#39;#findstore-results-body tr[data-order=&quot;&#39; + order + &#39;&quot;] .hide-results&#39;).replaceWith(
        &#39;&lt;div class=&quot;more-results&quot;&gt;+ Show more stores (&#39; + storeCount + &#39;)&lt;/div&gt;&#39;
    );
}

function filterTypes(){
    var filterTypes = [];
    if ($(&quot;input[name=&#39;type-filter[]&#39;]:checked&quot;).length &lt; 1) {
        filterTypes = [&#39;Home Center&#39;, &#39;Window and Door Store&#39;, &#39;Lumber Yard&#39;]
    } else {
        $.each($(&quot;input[name=&#39;type-filter[]&#39;]:checked&quot;), function() {;
            filterTypes.push($(this).val());
        });
    }
    var spliceMappings = [];
    $.each(findstore.mappings, function(i, mapping) {
        store = mapping.details;
        match = filterTypes.indexOf(store.type);
        if (match === -1) {
            spliceMappings.push(i);
        }
    });
    $.each(spliceMappings.reverse(), function(i, index) {
        findstore.mappings.splice(index, 1);
    });
}

function updateResults(){
    $(&#39;#findstore-right-bottom&#39;).show();
    $(&#39;#findstore-right-middle .message&#39;).remove();
    $(&#39;#findstore-results-body tr&#39;).not(&#39;.first&#39;).remove();
    $.each(findstore.mappings, function(i, mapping) {
        var store = mapping.details;
        if (i%2 == 0) { var oddeven = &#39;even&#39; } else { var oddeven = &#39;odd&#39; }
        var clone = $(&#39;#findstore-results-body tr.first&#39;).clone();
        clone.show();
        clone.removeClass(&#39;first&#39;).addClass(oddeven).attr(&#39;data-order&#39;, i).attr(&#39;data-group&#39;, mapping.group);
        clone.find(&#39;.marker img&#39;).attr(&#39;src&#39;, &#39;http://chart.apis.google.com/chart?chst=d_map_spin&amp;chld=.75|0|CAD7FC|16|b|&#39; + (i + 1));        
        clone.find(&#39;.details h5&#39;).html(store.name);
        clone.find(&#39;.details h6&#39;).html(store.type);
        clone.find(&#39;.details p&#39;).html(store.address + &#39;&lt;br&gt;&#39; + store.city + &#39;, &#39; + store.state + &#39; &#39; + store.zip + &#39;&lt;br&gt;&#39; + store.phone);
        clone.find(&#39;.details span&#39;).html(store.distance + &#39; mi&#39;);
        clone.find(&#39;.directions a&#39;).attr(&#39;href&#39;, &#39;index.php?option=com_jw_findstore&amp;layout=directions&amp;address=&#39; + store.address + &#39; &#39; + store.city + &#39;, &#39; + store.state + &#39; &#39; + store.zip + &#39;&amp;position=&#39; + mapping.marker.position + &#39;&amp;tmpl=hopup&#39;);
        clone.appendTo($(&#39;#findstore-results-body&#39;));

        $.each(store.products, function(p, product) {
            clone.find(&#39;td[data-category=&#39;+product.category+&#39;]&#39;).append(&#39;&lt;li data-match=&quot;&#39;+product.match+&#39;&quot;&gt;&#39; + product.name + &#39;&lt;/li&gt;&#39;);
        });

        if (mapping.children) {
            var storeCount = findstore.results[mapping.group].length -1;
            if (mapping.open){
                clone.find(&#39;td.store-info&#39;).append(&#39;&lt;div class=&quot;hide-results&quot;&gt;- Hide more stores (&#39; + storeCount + &#39;)&lt;/div&gt;&#39;);
            } else {
                clone.find(&#39;td.store-info&#39;).append(&#39;&lt;div class=&quot;more-results&quot;&gt;+ Show more results (&#39; + storeCount + &#39;)&lt;/div&gt;&#39;);
            }
        }

        if (mapping.child) {
            clone.addClass(&#39;child&#39;);
        }
    });

    if (findstore.mappings.length &gt; 0){
        updateMap();
    } else {
        clearMap();
        clearResults();
    }

    $(&quot;.iframe&quot;).colorbox({iframe:true, width:&quot;840px&quot;, height:&quot;600px&quot;, scrolling: false});
}

function updateMap(){
    clearMap();
    findstore.bounds = new google.maps.LatLngBounds();
    $.each(findstore.mappings, function(i, mapping) {
        var store = mapping.details;
        var overlay = 
            &#39;&lt;div class=&quot;details&quot;&gt;&#39; +
                &#39;&lt;h4&gt;&#39; + store.name + &#39;&lt;/h4&gt;&#39; +
                &#39;&lt;h6&gt;&#39; + store.type + &#39;&lt;/h6&gt;&#39; +
                &#39;&lt;p&gt;&#39; + store.address + &#39;&lt;/p&gt;&#39; +
                &#39;&lt;p&gt;&#39; + store.city + &#39;, &#39; + store.state + &#39; &#39; + store.zip + &#39;&lt;/p&gt;&#39; +
                &#39;&lt;p&gt;&#39; + store.phone + &#39;&lt;/p&gt;&#39; +
                &#39;&lt;span&gt;&#39; + store.distance + &#39; mi&lt;/span&gt;&#39; +
            &#39;&lt;/div&gt;&#39;;
        mapping.marker.setIcon(&#39;http://chart.apis.google.com/chart?chst=d_map_spin&amp;chld=.75|0|CAD7FC|16|b|&#39; + ( i + 1 ));
        mapping.marker.setMap(map);
        google.maps.event.addListener(mapping.marker, &#39;click&#39;, function() {
            findstore.infoWindow.close();
            infoWindow.setContent(overlay);
              map.setZoom(10);
              map.panTo(mapping.marker.getPosition());
              findstore.infoWindow.open(map, mapping.marker);
        });

        findstore.bounds.extend(mapping.marker.position);
        findstore.markers.push(mapping.marker);
    });

    map.fitBounds(findstore.bounds);
}

function clearResults(){
    $(&#39;#findstore-results-body tr&#39;).not(&#39;.first&#39;).remove();
    $(&#39;#findstore-right-bottom&#39;).hide();
    $(&#39;#findstore-right-middle .message&#39;).remove();
    $(&#39;#findstore-right-middle&#39;).append(&#39;&lt;span class=&quot;message&quot;&gt;There are no locations that match your criteria. Please try a different search.&lt;/span&gt;&#39;);
}

function clearMap(){
    for (var i = 0; i &lt; findstore.markers.length; i++) {
        findstore.markers[i].setMap(null);
    }
    findstore.markers.length = 0;
}
</code></pre>

					</div>
				
					<li>
						<i class="fa fa-file-code-o"></i>
						<a href="#" data-reveal-id="modal-php_findstore_controller">
							findstoreController.php
						</a>
					</li>

					<div id="modal-php_findstore_controller" class="reveal-modal" data-reveal>
						<pre><code class="language-php">&lt;?php

/**
 * @version     1.0.0
 * @package     com_jw_findstore
 * @copyright   JELD-WEN © Copyright 2012. All Rights Reserved.
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 * @author      Alex Crawford &lt;alexc@jeld-wen.com&gt; - JELD-WEN http://jeld-wen.com
 */

header(&#39;Content-Type: application/json&#39;);
defined(&#39;_JEXEC&#39;) or die;
require_once JPATH_COMPONENT.&#39;/controller.php&#39;;

class Jw_findstoreControllerFindstore extends Jw_findstoreController
{

    public function search() {

        $mappings = $this-&gt;getModel()-&gt;getMappings();
        $collections = $this-&gt;getModel()-&gt;getCollections();

        $selZip = (empty($_GET[&#39;selZip&#39;]) ? null : $_GET[&#39;selZip&#39;]);
        $selFilters = (empty($_GET[&#39;selFilters&#39;]) ? array() : $_GET[&#39;selFilters&#39;]);
        $selRadius = (empty($_GET[&#39;selRadius&#39;]) ? 40 : $_GET[&#39;selRadius&#39;]);
        $selModel = (empty($_GET[&#39;selModel&#39;]) ? null : $_GET[&#39;selModel&#39;]);

        $url = &#39;GetDealersTest?zip=&#39;. $selZip .&#39;&amp;distance=&#39;. $selRadius .&#39;&amp;collectionId=&#39;. implode(&#39;,&#39;, $selFilters);

        $debug = false;
        if ($debug == true) {
            $url = &#39;tests/findstore.xml&#39;;
            $xml = simplexml_load_file($url);
        } else {
            $ch = curl_init($url);
            $options = array(
                CURLOPT_FOLLOWLOCATION =&gt; true,
                CURLOPT_RETURNTRANSFER =&gt; true,
                CURLOPT_SSLCERT =&gt; JPATH_BASE.&#39;...&#39;,
                CURLOPT_SSLCERTPASSWD =&gt; &#39;...&#39;,
                CURLOPT_SSLKEY =&gt; JPATH_BASE.&#39;...&#39;,
            );
            curl_setopt_array($ch, $options);
            $response = curl_exec($ch);
            $xml = new SimpleXMLElement($response);
        }

        $storeId = 0;
        $dealerGroups = array();
        foreach ($xml-&gt;DealerGroup as $dealerGroup) {

            // HOTFIX: Remove Madison from Home Depot / Lowe&#39;s
            if($selModel == &#39;madison&#39;) {
                $accum = (isset($dealerGroup-&gt;attributes()-&gt;accum) ? $dealerGroup-&gt;attributes()-&gt;accum : null);
                if ($accum == &#39;509&#39; || $accum == &#39;612&#39;){
                    continue;
                }
            }

            $dealers = array();
            foreach ($dealerGroup-&gt;Dealer as $dealer) {

                // HOTFIX: Remove Madison from Home Depot / Lowe&#39;s
                if($selModel == &#39;madison&#39;) {
                    $name = (isset($dealer-&gt;attributes()-&gt;name) ? $dealer-&gt;attributes()-&gt;name : null);
                    if (strpos($name, &quot;LOWE&#39;S&quot;) !== false || strpos($name, &quot;HOME DEPOT&quot;) !== false){
                        continue;
                    }
                }

                $products = array();
                $matchAny = false;
                $categories = array();            

                foreach ($dealer-&gt;Product as $product) {
                    $productMatch = false;

                    foreach($collections as $key =&gt; $val) {
                        if ( $val-&gt;col_id == $product-&gt;attributes()-&gt;number ) {

                            // prepare the first two segments for comparison
                            $productSegments = explode(&quot;.&quot;, $product-&gt;attributes()-&gt;number);
                            if ( count($productSegments) &gt; 1 ) {
                                $productCategory = $productSegments[0].&quot;.&quot;.$productSegments[1];
                            }

                            // prepare the product for highlighting
                            if (in_array($productCategory, $selFilters)) {
                                $productMatch = true;
                            }        

                            // re-set the productCategory to integer so we can easily put it in the right column
                            foreach ( $mappings as $mapping ) {
                                // if no mapping has been set up in the back-end, the product will not be added
                                if ($productCategory == $mapping-&gt;collections ) {
                                    $productName = $val-&gt;title;
                                    $productNumber = $val-&gt;col_id;
                                    $productCategory = $mapping-&gt;category;
                                    $products[] = array(
                                        &#39;name&#39; =&gt; $productName,
                                        &#39;number&#39; =&gt; $productNumber,
                                        &#39;category&#39; =&gt; $productCategory,
                                        &#39;match&#39; =&gt; $productMatch,
                                    );
                                    $categories[] = $mapping-&gt;collections;
                                }
                            }
                        }
                    }
                }

                // Make sure the dealer has a match
                foreach ($selFilters as $selFilter) {
                    if (in_array($selFilter, $categories)) {
                        $matchAny = true;
                    }
                }

                // only return dealers with at least one match, unless search is empty
                if ($matchAny == true || empty($_GET[&#39;selFilters&#39;])) {
                    // if a dealer has no products, do not return the dealer
                    if ( count($products) &gt; 0 ) {
                        $dealers[] = array(
                            &#39;id&#39; =&gt; $storeId,
                            &#39;name&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;name,
                            &#39;type&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;storeType,
                            &#39;address&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;addrline1,
                            &#39;city&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;city,
                            &#39;state&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;state,
                            &#39;zip&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;zip,
                            &#39;phone&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;phone,
                            &#39;distance&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;distance,
                            &#39;lat&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;lat,
                            &#39;lon&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;lon,
                            &#39;products&#39; =&gt; $products,
                        );
                    $storeId = $storeId + 1;
                    }
                }
            }

            if (!empty($dealers)) {
                $dealerGroups[] = $dealers;
            }

            if (count($dealerGroups) === 15) {
                break;
            }

        }

        $dealerGroups = json_encode($dealerGroups);
        die($dealerGroups);

    }

    public function debug() {

        $timeBench03start = microtime(true);

        //$_GET[&#39;selZip&#39;] = &#39;97601&#39;;
        //$_GET[&#39;selFilters&#39;] = array(&#39;1.1&#39;, &#39;1.3&#39;);
        //$_GET[&#39;selRadius&#39;] = &#39;40&#39;;

        if (empty($_GET[&#39;selFilters&#39;])) {
            $_GET[&#39;selFilters&#39;] = array();
        }

        if (empty($_GET[&#39;selZip&#39;])) {
            $_GET[&#39;selZip&#39;] = null;
        }

        if (empty($_GET[&#39;selRadius&#39;])) {
            $_GET[&#39;selRadius&#39;] = &#39;40&#39;;
        }

        $selZip = $_GET[&#39;selZip&#39;];
        $selFilters = $_GET[&#39;selFilters&#39;];
        $selRadius = $_GET[&#39;selRadius&#39;];

        $url = &#39;.../GetDealersTest?zip=&#39;. $selZip .&#39;&amp;distance=&#39;. $selRadius .&#39;&amp;collectionId=&#39;. $selFilters;
        //$url = &#39;webappstest1.local/atlas/GetDealers/report.xml?zip=&#39;. $selZip .&#39;&amp;distance=40&amp;collectionId=&#39;. $selFilters;

        $timeBench01start = microtime(true);

        $ch = curl_init($url);
        $options = array(
            CURLOPT_FOLLOWLOCATION =&gt; true,
            CURLOPT_RETURNTRANSFER =&gt; true,
            CURLOPT_SSLCERT =&gt; JPATH_BASE.&#39;...&#39;,
            CURLOPT_SSLCERTPASSWD =&gt; &#39;...&#39;,
            CURLOPT_SSLKEY =&gt; JPATH_BASE.&#39;...&#39;,
        );
        curl_setopt_array($ch, $options);

        $response = curl_exec($ch);
        $xml = new SimpleXMLElement($response);

        $timeBench01end = microtime(true);
        $timeBench01 = ($timeBench01end - $timeBench01start);  

        $timeBench02start = microtime(true);

        $mappings = $this-&gt;getModel()-&gt;getMappings();
        $collections = $this-&gt;getModel()-&gt;getCollections();

        $storeId = 0;
        $dealerGroups = array();
        foreach ($xml-&gt;DealerGroup as $dealerGroup) {
            $dealers = array();
            // any product with a mapping and collection in our component&#39;s back end will be returned in the result
            foreach ($dealerGroup-&gt;Dealer as $dealer) {
                $products = array();
                $matchAny = false;
                $categories = array();            

                foreach ($dealer-&gt;Product as $product) {
                    $productMatch = false;

                    foreach($collections as $key =&gt; $val) {
                        if ( $val-&gt;col_id == $product-&gt;attributes()-&gt;number ) {

                            // prepare the first two segments for comparison
                            $productSegments = explode(&quot;.&quot;, $product-&gt;attributes()-&gt;number);
                            if ( count($productSegments) &gt; 1 ) {
                                $productCategory = $productSegments[0].&quot;.&quot;.$productSegments[1];
                            }

                            // prepare the product for highlighting
                            if (in_array($productCategory, $selFilters)) {
                                $productMatch = true;
                            }        

                            // re-set the productCategory to integer so we can easily put it in the right column
                            foreach ( $mappings as $mapping ) {
                                // if no mapping has been set up in the back-end, the product will not be added
                                if ($productCategory == $mapping-&gt;collections ) {
                                    $productName = $val-&gt;title;
                                    $productNumber = $val-&gt;col_id;
                                    $productCategory = $mapping-&gt;category;
                                    $products[] = array(
                                        &#39;name&#39; =&gt; $productName,
                                        &#39;number&#39; =&gt; $productNumber,
                                        &#39;category&#39; =&gt; $productCategory,
                                        &#39;match&#39; =&gt; $productMatch,
                                    );
                                    $categories[] = $mapping-&gt;collections;
                                }
                            }
                        }
                    }
                }

                // Make sure the dealer has a match
                foreach ($selFilters as $selFilter) {
                    if (in_array($selFilter, $categories)) {
                        $matchAny = true;
                    }
                }

                // only return dealers with at least one match, unless search is empty
                if ($matchAny == true || empty($_GET[&#39;selFilters&#39;])) {
                    // if a dealer has no products, do not return the dealer
                    if ( count($products) &gt; 0 ) {
                        $dealers[] = array(
                            &#39;id&#39; =&gt; $storeId,
                            &#39;name&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;name,
                            &#39;type&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;storeType,
                            &#39;address&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;addrline1,
                            &#39;city&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;city,
                            &#39;state&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;state,
                            &#39;zip&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;zip,
                            &#39;phone&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;phone,
                            &#39;distance&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;distance,
                            &#39;lat&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;lat,
                            &#39;lon&#39; =&gt; (string)$dealer-&gt;attributes()-&gt;lon,
                            &#39;products&#39; =&gt; $products,
                        );
                    $storeId = $storeId + 1;
                    }
                }
            }

            if (!empty($dealers)) {
                $dealerGroups[] = $dealers;
            }

        }

        $dealerGroups = json_encode($dealerGroups);

        $timeBench02end = microtime(true);
        $timeBench02 = ($timeBench02end - $timeBench02start);

        $timeBench03end = microtime(true);
        $timeBench03 = ($timeBench03end - $timeBench03start);

        if (empty($_GET[&#39;bench&#39;])) {
            var_dump($url);
            var_dump($xml);
        } else if ($_GET[&#39;bench&#39;] == &#39;1&#39;){
            var_dump(&#39;TIME: &#39; . $timeBench01 . &#39; seconds to return XML from service&#39;);
            var_dump($url);
            var_dump($xml);
        } else if ($_GET[&#39;bench&#39;] == &#39;2&#39;){
            var_dump(&#39;TIME: &#39; . $timeBench02 . &#39; seconds to parse XML into JSON array&#39;);
            var_dump($dealerGroups);
        } else if ($_GET[&#39;bench&#39;] == &#39;all&#39;){
            var_dump(&#39;TIME: &#39; . $timeBench03 . &#39; seconds for script to execute&#39;);
            var_dump($dealerGroups);
        }

        die;

    }

}
</code></pre>

					</div>
				
					<li>
						<i class="fa fa-file-code-o"></i>
						<a href="#" data-reveal-id="modal-php_findstore_model">
							findstoreController.php
						</a>
					</li>

					<div id="modal-php_findstore_model" class="reveal-modal" data-reveal>
						<pre><code class="language-php">&lt;?php

defined(&#39;_JEXEC&#39;) or die(&#39;Restricted access&#39;);
jimport(&#39;joomla.application.component.modelitem&#39;);

class Jw_findstoreModelJw_findstore extends JModelItem
{
        protected $filters;
        protected $collections;

        public function getFilters() 
        {
                $db = JFactory::getDBO();
                $query = $db-&gt;getQuery(true);
                $query-&gt;select(&#39;id,title,image,ordering&#39;);
                $query-&gt;from(&#39;#__jw_findstore_categories&#39;);
                $query-&gt;where(&#39;state = 1&#39;);
                $query-&gt;order(&#39;ordering ASC&#39;);
                $db-&gt;setQuery((string)$query);
                $categories = $db-&gt;loadObjectList();

                foreach ($categories as $category){
                        $db = JFactory::getDBO();
                        $query = $db-&gt;getQuery(true);
                        $query-&gt;select(&#39;id,title,collections,category,uris,ordering&#39;);
                        $query-&gt;from(&#39;#__jw_findstore_mappings&#39;);
                        $query-&gt;where(&#39;state = 1&#39;);
                        $query-&gt;where(&#39;category = &#39;.$category-&gt;id);
                        $query-&gt;order(&#39;ordering ASC&#39;);
                        $db-&gt;setQuery((string)$query);
                        $mappings = $db-&gt;loadObjectList();
                        $filters[] = array($category-&gt;id =&gt; $category-&gt;title, &quot;image&quot; =&gt; $category-&gt;image, &quot;mappings&quot; =&gt; $mappings);
                }

                return $filters;
        }

        public function getCollections() 
        {
                $db = JFactory::getDBO();
                $query = $db-&gt;getQuery(true);
                $query-&gt;select(&#39;id,title,col_id,ordering&#39;);
                $query-&gt;from(&#39;#__jw_findstore_collections&#39;);
                $query-&gt;where(&#39;state = 1&#39;);
                $query-&gt;order(&#39;ordering ASC&#39;);
                $db-&gt;setQuery((string)$query);
                $collections = $db-&gt;loadObjectList();

                //$collections = json_encode($collections);
                return $collections;
        }

        public function getMappings() 
        {
                $db = JFactory::getDBO();
                $query = $db-&gt;getQuery(true);
                $query-&gt;select(&#39;id,collections,category, uris&#39;);
                $query-&gt;from(&#39;#__jw_findstore_mappings&#39;);
                $query-&gt;where(&#39;state = 1&#39;);
                $db-&gt;setQuery((string)$query);
                $mappings = $db-&gt;loadObjectList();

                return $mappings;
        }

        public function getUris() 
        {
                $db = JFactory::getDBO();
                $query = $db-&gt;getQuery(true);
                $query-&gt;select(&#39;id,collections,category,uris&#39;);
                $query-&gt;from(&#39;#__jw_findstore_mappings&#39;);
                $query-&gt;where(&#39;state = 1&#39;);
                $db-&gt;setQuery((string)$query);
                $mappings = $db-&gt;loadObjectList();

                foreach ($mappings as $mapping){
                        $db = JFactory::getDBO();
                        $query = $db-&gt;getQuery(true);
                        $query-&gt;select(&#39;id,title,collections,category,ordering&#39;);
                        $query-&gt;from(&#39;#__jw_findstore_mappings&#39;);
                        $query-&gt;where(&#39;state = 1&#39;);
                        $query-&gt;where(&#39;category = &#39;.$category-&gt;id);
                        $query-&gt;order(&#39;ordering ASC&#39;);
                        $db-&gt;setQuery((string)$query);
                        $mappings = $db-&gt;loadObjectList();
                        $filters[] = array($category-&gt;id =&gt; $category-&gt;title, &quot;image&quot; =&gt; $category-&gt;image, &quot;mappings&quot; =&gt; $mappings);
                }

                return $filters;
        }

}
</code></pre>

					</div>
				
					<li>
						<i class="fa fa-file-code-o"></i>
						<a href="#" data-reveal-id="modal-js_orderstatus">
							orderstatus.js
						</a>
					</li>

					<div id="modal-js_orderstatus" class="reveal-modal" data-reveal>
						<pre><code class="language-javascript">if ($(&#39;#com_jw_lookup&#39;).length &gt; 0 ){
    var com_jw_lookup = new Com_jw_lookup();
    com_jw_lookup.init();
}

function Com_jw_lookup(){

    var self = this;
    self.order = {};
    self.ordertype;
    self.inputmask = {};
    self.inputmask[&#39;store&#39;] = &#39;1234-123456&#39;;
    self.inputmask[&#39;online&#39;] = &#39;W123456789&#39;;
    self.inputlength = {};
    self.inputlength[&#39;store&#39;] = 11;
    self.inputlength[&#39;online&#39;] = 10;
    self.phones = {};
    self.phones[&#39;store&#39;] = &#39;1-800-HOME-DEPOT (1-800-466-3337)&#39;;
    self.phones[&#39;online&#39;] = &#39;1-800-430-3376&#39;;

    self.init = function(){

        // Next
        $(&#39;input.next&#39;).click(function(){
            var valid = self.validateStep(1);
            if(!valid) return false;

            self.ordertype = $(&#39;input[name=&quot;ordertype&quot;]:checked&#39;).val();
            $(&#39;.typeinfo&#39;).hide();
            $(&#39;.typeinfo[data-type=&#39; + self.ordertype + &#39;]&#39;).show();

            if(self.ordertype === &#39;online&#39;){
                $(&#39;#lookup-contact h6 b&#39;).html(self.phones[self.ordertype]);
            }

            var ordernumInput = $(&#39;input[name=&quot;ordernum&quot;]&#39;);
            $(ordernumInput).attr(&quot;placeholder&quot;, self.inputmask[self.ordertype]);
            $(ordernumInput).attr(&quot;maxlength&quot;, self.inputlength[self.ordertype]);

            $(&#39;.lookup-step[data-step=1]&#39;).hide();
            $(&#39;.lookup-step[data-step=2]&#39;).show();
            $(&#39;#errormsg&#39;).html(&#39;&#39;).hide();
        });

        // Prev
        $(&#39;input.prev&#39;).click(function(){
            $(&#39;input[name=&quot;ordernum&quot;]&#39;).val(&#39;&#39;);
            $(&#39;input[name=&quot;lastname&quot;]&#39;).val(&#39;&#39;);
            $(&#39;.lookup-step[data-step=2]&#39;).hide();
            $(&#39;.lookup-step[data-step=1]&#39;).show();
            $(&#39;#errormsg&#39;).html(&#39;&#39;).hide();
            $(&#39;#lookup-contact h6 b&#39;).html(&#39;1-800-HOME-DEPOT &lt;br&gt; (1-800-466-3337)&#39;);
        });

        // Submit
        $(&#39;#lookup-form&#39;).submit(function(e){
            e.preventDefault();

            var valid = self.validateStep(2);
            if(!valid) return false;

            var form = this;
            var url = form.action;
            var input = $(&#39;#lookup-form&#39;).serialize();
            $.post(url, input)
                .done(function(response){
                    if(response.result == &#39;success&#39;){
                        self.showResult(response);
                    } else if(response.result == &#39;fail&#39;){
                        self.showFail();
                    } else {
                        self.showNoResult();
                    }
                }).fail(function(xhr) {
                    self.showFail();
                    console.log(xhr);
                }
            );
        });

        // New Lookup
        $(&#39;input.newlookup&#39;).click(function(){
            $(&#39;#lookup-result li&#39;).removeClass();
            $(&#39;#lookup-result li .check&#39;).hide();
            $(&#39;#lookup-result .ordernum&#39;).html(&#39;&#39;);
            $(&#39;#lookup-result #recdate&#39;).html(&#39;&#39;);
            $(&#39;#lookup-result #estdate&#39;).html(&#39;Not Yet Available&#39;);
            $(&#39;input[name=&quot;ordertype&quot;]&#39;).prop(&#39;checked&#39;, false);
            $(&#39;input[name=&quot;ordernum&quot;]&#39;).val(&#39;&#39;);
            $(&#39;input[name=&quot;lastname&quot;]&#39;).val(&#39;&#39;);
            $(&#39;.lookup-step[data-step=3]&#39;).hide();
            $(&#39;.lookup-step[data-step=1]&#39;).show();
            $(&#39;#lookup-contact h6 b&#39;).html(&#39;1-800-HOME-DEPOT &lt;br&gt; (1-800-466-3337)&#39;);
        });

        // Loading icon
        $(&quot;#ajax-loader&quot;).bind(&quot;ajaxStart&quot;, function(){
            $(this).show();
        }).bind(&quot;ajaxComplete&quot;, function(){
            $(this).hide();
        });

        // Invoice Modal
        $(&#39;a#popup-store&#39;).click(function(e){
            console.log($(this).data(&#39;path&#39;));
            var path = $(this).data(&#39;path&#39;) + &#39;components/com_jw_lookup/assets/img/invoices/&#39; + self.ordertype + &#39;.png&#39;;
            modal.open({
                    content: &#39;&lt;img src=&quot;&#39; + path + &#39;&quot; width=&quot;100%&quot;&gt;&#39;,
                    width: 700,
                    height: 400
            });
            e.preventDefault();
        });

        $(&#39;a#popup-online&#39;).click(function(e){
            console.log($(this).data(&#39;path&#39;));
            var path = $(this).data(&#39;path&#39;) + &#39;components/com_jw_lookup/assets/img/invoices/&#39; + self.ordertype + &#39;.png&#39;;
            modal.open({
                content: &#39;&lt;img src=&quot;&#39; + path + &#39;&quot; width=&quot;100%&quot;&gt;&#39;,
                width: 700,
                height: 400
            });
            e.preventDefault();
        });

        // Input mask
        $(&#39;input[name=&quot;ordernum&quot;]&#39;).keyup(function() {
            $(&#39;input[name=&quot;ordernum&quot;]&#39;).removeClass(&#39;error&#39;);
            var start = this.selectionStart,
                end = this.selectionEnd;
            if (event.keyCode == 8 || event.keyCode == 46 || event.keyCode == 37 || event.keyCode == 39) return false;
            if(self.ordertype === &#39;store&#39;) {
                var value = $(this).val();
                if (value.length &gt; 4) {
                    value = value.replace(&#39;-&#39;, &#39;&#39;);
                    $(this).val(value.substring(0,4) + &#39;-&#39; + value.slice(4));
                } 
                if(start === 5){
                    start++;
                    end++;
                }
            }
            this.setSelectionRange(start, end);
        });
    }

    self.showResult = function(result){
        $(&#39;.lookup-step[data-step=2]&#39;).hide();
        $(&#39;.lookup-step[data-step=3]&#39;).show();

        $(&#39;#lookup-result .ordernum&#39;).html(result.ordernum);
        $(&#39;#lookup-result #recdate&#39;).html(result.recdate);
        $(&#39;#lookup-result #estdate&#39;).html(result.estdate);
        $(&#39;#lookup-result #lastupdate&#39;).html(result.lastupdate);

        for(i = 0; i &lt; (result.step); i++) {
            var item = $(&#39;#lookup-result li:nth-child(&#39;+ i +&#39;)&#39;);
            item.addClass(&#39;success&#39;);
            item.children(&#39;.check&#39;).css(&#39;display&#39;, &#39;inline-block&#39;);
        }

        $(&#39;#lookup-result li:nth-child(&#39;+ result.step +&#39;)&#39;).addClass(&#39;current&#39;);
        if(result.step &gt; 5){
            $(&#39;#lookup-result li:nth-child(5) h5&#39;).html(&#39;Shipped Order&#39;);
        } else {
            $(&#39;#lookup-result li:nth-child(5) h5&#39;).html(&#39;Shipping Order&#39;);
        }

        switch(result.extra) {
            case &#39;partial&#39;:
                $(&#39;#lookup-extra&#39;).html(&#39;&lt;p&gt;* One or more of your items have shipped. Please contact customer service for information about the remaining items in your order: &#39; + self.phones[self.ordertype] + &#39;&lt;/p&gt;&#39;);
                break;
            case &#39;split&#39;:
            case &#39;cancel&#39;:
                $(&#39;#lookup-extra&#39;).html(&#39;&lt;p&gt;* Please contact customer service regarding your order.&lt;br&gt; We apologize for any inconvenience. &lt;br&gt;&lt;b&gt;Please Contact: &#39; + self.phones[self.ordertype] + &#39;&lt;/b&gt;&lt;/p&gt;&#39;);
                break;
            default:
                $(&#39;#lookup-extra&#39;).html(&#39;&#39;);
        }
    }

    self.showNoResult = function(){
        $(&#39;#errormsg&#39;).html(&#39;Your order could not be found. Please re-enter the order number as it appears on the receipt or in the confirmation email.&#39;).show();
    }

    self.showFail = function(){
        $(&#39;#errormsg&#39;).html(&#39;Please contact customer service regarding your order.&lt;br&gt; We apologize for any inconvenience. &lt;br&gt;&lt;b&gt;Please Contact: &#39; + self.phones[self.ordertype] + &#39;&lt;/b&gt;&#39;).show();
    }

    self.validateStep = function(step){
        var isValid = true;
        switch(step){
            case 1:
                if(!$(&#39;input[name=&quot;ordertype&quot;]&#39;).is(&#39;:checked&#39;)){
                    $(&#39;#errormsg&#39;).html(&#39;Please choose an order type.&#39;).show();
                    isValid = false;
                }
                break;
            case 2:
                var value = $(&#39;input[name=&quot;ordernum&quot;]&#39;).val().replace(&#39;-&#39;, &#39;&#39;);
                if(value == &#39;&#39;){
                    $(&#39;#errormsg&#39;).html(&#39;Please input your order number.&#39;).show();
                    $(&#39;input[name=&quot;ordernum&quot;]&#39;).addClass(&#39;error&#39;);
                    isValid = false;
                } else if(self.ordertype == &#39;store&#39;) {
                    //var trim = value.replace(&#39;-&#39;, &#39;&#39;);
                    if(isNaN(value)){
                        $(&#39;#errormsg&#39;).html(&#39;Your order number should only contain numbers.&#39;).show();
                        $(&#39;input[name=&quot;ordernum&quot;]&#39;).addClass(&#39;error&#39;);
                        isValid = false;
                    } else if(value.length &lt;= 4){
                        $(&#39;#errormsg&#39;).html(&#39;Please verify your order number length.&#39;).show();
                        $(&#39;input[name=&quot;ordernum&quot;]&#39;).addClass(&#39;error&#39;);
                        isValid = false;
                    }
                } else if(self.ordertype == &#39;online&#39;) {
                    var first = value.charAt(0).toUpperCase();
                    if(first != &#39;W&#39; &amp;&amp; first != &#39;C&#39;){
                        $(&#39;#errormsg&#39;).html(&#39;Your order number should begin with a C or W.&#39;).show();
                        $(&#39;input[name=&quot;ordernum&quot;]&#39;).addClass(&#39;error&#39;);
                        isValid = false;
                    } else if(value.length != 10){
                        $(&#39;#errormsg&#39;).html(&#39;Your order number should be 10 characters long.&#39;).show();
                        $(&#39;input[name=&quot;ordernum&quot;]&#39;).addClass(&#39;error&#39;);
                        isValid = false;
                    }
                }
                if(isValid) {
                    $(&#39;input[name=&quot;ordernum&quot;]&#39;).removeClass(&#39;error&#39;);
                }
                break;
        }
        if(isValid) $(&#39;#errormsg&#39;).html(&#39;&#39;).hide();
        return isValid;
    }
}

var modal = (function(){
    var 
    method = {},
    $overlay,
    $modal,
    $content,
    $close;

    // Center the modal in the viewport
    method.center = function () {
        var top, left;

        top = Math.max($(window).height() - $modal.outerHeight(), 0) / 2;
        left = Math.max($(window).width() - $modal.outerWidth(), 0) / 2;

        $modal.css({
            top:top + $(window).scrollTop(), 
            left:left + $(window).scrollLeft()
        });
    };

    // Open the modal
    method.open = function (settings) {
        $content.empty().append(settings.content);

        $modal.css({
            width: settings.width || &#39;auto&#39;, 
            height: settings.height || &#39;auto&#39;
        });

        method.center();
        $(window).bind(&#39;resize.modal&#39;, method.center);
        $modal.show();
        $overlay.show();
    };

    // Close the modal
    method.close = function () {
        $modal.hide();
        $overlay.hide();
        $content.empty();
        $(window).unbind(&#39;resize.modal&#39;);
    };

    // Generate the HTML and add it to the document
    $overlay = $(&#39;&lt;div class=&quot;com_jw_lookup hopup overlay&quot;&gt;&lt;/div&gt;&#39;);
    $modal = $(&#39;&lt;div class=&quot;com_jw_lookup hopup main&quot;&gt;&lt;/div&gt;&#39;);
    $content = $(&#39;&lt;div class=&quot;com_jw_lookup hopup content&quot;&gt;&lt;/div&gt;&#39;);
    $close = $(&#39;&lt;a class=&quot;com_jw_lookup hopup close&quot; href=&quot;#&quot;&gt;close&lt;/a&gt;&#39;);

    $modal.hide();
    $overlay.hide();
    $modal.append($content, $close);

    $(document).ready(function(){
        $(&#39;body&#39;).append($overlay, $modal);                        
    });

    $close.click(function(e){
        e.preventDefault();
        method.close();
    });

    return method;
}());
</code></pre>

					</div>
				
					<li>
						<i class="fa fa-file-code-o"></i>
						<a href="#" data-reveal-id="modal-php_orderstatus">
							orderstatus.php
						</a>
					</li>

					<div id="modal-php_orderstatus" class="reveal-modal" data-reveal>
						<pre><code class="language-php">&lt;?php

ini_set(&#39;soap.wsdl_cache_enabled&#39;, &#39;0&#39;); 
ini_set(&#39;soap.wsdl_cache_ttl&#39;, &#39;0&#39;); 

defined(&#39;_JEXEC&#39;) or die;
require_once JPATH_COMPONENT.&#39;/controller.php&#39;;

class Jw_lookupControllerStatus extends Jw_lookupController
{

    public function lookupOrder()
    {
        $debug = (isset($_GET[&quot;debug&quot;]) &amp;&amp; $_GET[&#39;debug&#39;] == &#39;true&#39; ) ? true : false;

        if ($debug) {
            ini_set(&quot;display_errors&quot;, 1);
            $input = $_GET;
            echo &#39;&lt;pre&gt;&#39;;
        } else {
            header(&#39;Content-Type: application/json&#39;);
            $input = $_POST;
        }

        $ordernum = $input[&#39;ordernum&#39;];

        $url = &quot;.../Jw_Thd_Wsi_GetOrderStatusWS?wsdl&quot;;
        $local_cert = &quot;...&quot;;
        $passphrase = &quot;...&quot;;
        $options = array(
            &#39;local_cert&#39; =&gt; $local_cert,
            &#39;passphrase&#39; =&gt; $passphrase,
            &#39;trace&#39; =&gt; 1,
            &#39;cache_wsdl&#39; =&gt; WSDL_CACHE_NONE 
        );

        $parameters = array(
            &quot;OrderNumber&quot; =&gt; $input[&#39;ordernum&#39;]
        );

        $output = array();

        try {
            $client = new SoapClient($url, $options);
            $client-&gt;__setLocation(&#39;.../Jw_Thd_Wsi_GetOrderStatusWS?wsdl&#39;);
            $response = $client-&gt;getOrderStatus($parameters);

            if($debug){
                $reqXML = $client-&gt;__getLastRequest();
                $respXML = $client-&gt;__getLastResponse();
                echo &#39;&lt;h1&gt;Request&lt;/h1&gt;&#39;;
                echo $reqXML;
                echo &#39;&lt;h1&gt;Response&lt;/h1&gt;&#39;;
                echo $respXML;
                echo &#39;&lt;h1&gt;Output&lt;/h1&gt;&#39;;
                var_dump($response);
            }

            $output[&#39;ordernum&#39;] = $ordernum;
            if($response-&gt;Result == &quot;SUCCESS&quot;) {
                $output[&#39;result&#39;] = &#39;success&#39;;
                $dt = new DateTime($response-&gt;OrderCreateDate);
                $output[&#39;recdate&#39;] = $dt-&gt;format(&#39;m/d/Y&#39;);

                $startdate = $response-&gt;EstimatedDeliveryDateStart-&gt;_;
                $enddate = $response-&gt;EstimatedDeliveryDateEnd-&gt;_;

                if($startdate != &#39;NULL&#39; &amp;&amp; $enddate != &#39;NULL&#39;){
                    $startDt = new DateTime($response-&gt;EstimatedDeliveryDateStart-&gt;_);
                    $endDt = new DateTime($response-&gt;EstimatedDeliveryDateEnd-&gt;_);
                    if($startDt == $endDt){
                        $output[&#39;estdate&#39;] = $endDt-&gt;format(&#39;m/d/Y&#39;);
                    } else {
                        $output[&#39;estdate&#39;] = $startDt-&gt;format(&#39;m/d/Y&#39;) . &#39; - &#39; . $endDt-&gt;format(&#39;m/d/Y&#39;);
                    }
                } else {
                    $output[&#39;estdate&#39;] = &#39;&lt;b class=&quot;error&quot;&gt;Contact Customer Service&lt;/b&gt;&#39;;
                    $output[&#39;extra&#39;] = &#39;split&#39;;
                }

                $lastupdate = $response-&gt;LastUpdatedDateTime-&gt;_;
                if($lastupdate != &#39;NULL&#39;){
                    $lastupDt = new DateTime($response-&gt;LastUpdatedDateTime-&gt;_);
                    $output[&#39;lastupdate&#39;] = $lastupDt-&gt;format(&#39;m/d/Y&#39;);
                } else {
                    $output[&#39;lastupdate&#39;] = &#39;&lt;b&gt;N/A.&lt;/b&gt;&#39;;
                }

                $output[&#39;step&#39;] = $this-&gt;getOrderStep($response);

                if ($response-&gt;OrderCanceled == true){
                    $output[&#39;extra&#39;] = &#39;cancel&#39;;
                } elseif ($response-&gt;PartialOrder){
                    $output[&#39;extra&#39;] = &#39;partial&#39;;
                } elseif ($response-&gt;SplitOrder){
                    $output[&#39;extra&#39;] = &#39;split&#39;;
                }

            } else {
                $output[&#39;result&#39;] = &#39;error&#39;;
            }
        } catch(Exception $e) {
            if($debug){
                echo &#39;&lt;h1&gt;Error&lt;/h1&gt;&#39;;
                var_dump($e);
            }
            $output[&#39;result&#39;] = &#39;fail&#39;;
        }

        if($debug){
            echo &#39;&lt;h1&gt;JSON&lt;/h1&gt;&#39;;
            die(json_encode($output));
        } else {
            die(json_encode($output));
        }
    }

    public function lookupCustomer()
    {
        die();
    }

    public function getOrderStep($response) {
        if ($response-&gt;PreparingOrder == &#39;300&#39;){
            return &#39;1&#39;;
        } elseif ($response-&gt;PreparingOrder == &#39;200&#39;){
            return &#39;2&#39;;
        } elseif ($response-&gt;BuildingOrder == &#39;200&#39;){
            return &#39;3&#39;;
        } elseif ($response-&gt;PackagingOrder == &#39;200&#39;){
            return &#39;4&#39;;
        } elseif ($response-&gt;ShippedOrder == &#39;100&#39;){
            $endDt = new DateTime($response-&gt;EstimatedDeliveryDateEnd-&gt;_);
            $endDate = $endDt-&gt;format(&#39;m/d/Y&#39;);
            $nowDate = date(&#39;m/d/Y&#39;);
            if ($endDate &gt;= $nowDate) {
                return &#39;5&#39;;
            } else {
                return &#39;6&#39;;
            }
        } else {
            return &#39;0&#39;;
        }
    }

}
</code></pre>

					</div>
				
			</ul>

		
	</div>
	
</div>

			

		</div>

		<div id="footer">
			<div class="row">
				<div id="built_with_title" class="medium-8 columns text-right hide-for-small">
					This site is built with:
				</div>
				<div id="built_with_title_small" class="large-12 columns text-right show-for-small">
					This site is built with:
				</div>
				<div id="built_with" class="medium-4 columns pull-right">
					<div class="icon-bar four-up">
						<a href="http://harpjs.com/" target="_blank" class="item has-tip tip-top" data-tooltip aria-haspopup="true" title="Harp Web Server">
							<img src="/assets/img/vendor/harp.svg">
						</a>
						<a href="http://foundation.zurb.com/" target="_blank" class="item has-tip tip-top" data-tooltip aria-haspopup="true" title="Foundation Zurb 5">
							<img src="/assets/img/vendor/yeti.svg">
						</a>
						<a href="http://bower.io/" target="_blank" class="item has-tip tip-top" data-tooltip aria-haspopup="true" title="Bower Package Manager">
							<img src="/assets/img/vendor/bower.svg">
						</a>
						<a href="http://gruntjs.com/" target="_blank" class="item has-tip tip-top" data-tooltip aria-haspopup="true" title="Grunt Task Runner">
							<img src="/assets/img/vendor/grunt.png">
						</a>
					</div>
				</div>
			</div>
		</div>

		<script src="/assets/js/vendor/jquery.min.js"></script>
		<script src="/assets/js/vendor/foundation.min.js"></script>
		<script src="/assets/js/vendor/slick.min.js"></script>
		<script src="/assets/js/vendor/prism/prism-core.min.js"></script>
		<script src="/assets/js/vendor/prism/prism-php.min.js"></script>
		<script src="/assets/js/vendor/prism/prism-javascript.min.js"></script>
		<script src="/assets/js/app.js"></script>
	</body>
</html>